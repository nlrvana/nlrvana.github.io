{"version":3,"sources":["file:///Users/f10wers13eicheng/blog/origin/nlrvana-blog/assets/js/fixit-decryptor.js"],"sourcesContent":["/**\n * FixIt decryptor for encrypted pages and fixit-encryptor shortcode\n * @param {Object} options\n * @param {Function} [options.decrypted] [Lifecycle Hooks] handler after decrypting\n * @param {Function} [options.reset] [Lifecycle Hooks] handler after encrypting again\n * @param {Number} [options.duration=86400] number of seconds to cache decryption statistics. unit: s\n * @author @Lruihao https://lruihao.cn\n * @since v0.2.15\n */\nFixItDecryptor = function (options = {}) {\n  var _proto = FixItDecryptor.prototype;\n  this.options = options || {};\n  this.options.duration = this.options.duration || 24 * 60 * 60; // default cache one day\n  this.decryptedEventSet = new Set();\n  this.resetEventSet = new Set();\n  this.$el = document.querySelector('.fixit-decryptor-container');\n\n  /**\n   * decrypt content\n   * @param {String} base64EncodeContent encrypted content\n   */\n  var _decryptContent = (base64EncodeContent) =\u003e {\n    try {\n      this.$el.querySelector('.fixit-decryptor-loading').classList.add('d-none');\n      this.$el.querySelector('#fixit-decryptor-input').classList.add('d-none');\n      this.$el.querySelector('.fixit-encryptor-btn').classList.remove('d-none');\n      document.querySelector('#content').insertAdjacentHTML(\n        'afterbegin',\n        CryptoJS.enc.Base64.parse(base64EncodeContent).toString(CryptoJS.enc.Utf8)\n      );\n    } catch (err) {\n      return console.error(err);\n    }\n    // decrypted hook\n    console.log(this.decryptedEventSet)\n    for (const event of this.decryptedEventSet) {\n      event();\n    }    \n  };\n\n  /**\n   * initialize FixIt decryptor\n   */\n  _proto.init = () =\u003e {\n    this.addEventListener('decrypted', this.options?.decrypted);\n    this.addEventListener('reset', this.options?.reset);\n    this.validateCache();\n\n    const _decryptor = this;\n    this.$el.querySelector('#fixit-decryptor-input')?.addEventListener('keydown', function (e) {\n      if (e.key === 'Enter') {\n        e.preventDefault();\n        const $content = document.querySelector('#content');\n        const password = $content.getAttribute('data-password');\n        const input = this.value.trim();\n        const saltLen = input.length % 2 ? input.length : input.length + 1;\n        const inputMd5 = CryptoJS.MD5(input).toString();\n        const inputSha256 = CryptoJS.SHA256(input).toString();\n\n        this.value = '';\n        this.blur();\n        if (!input) {\n          alert('Please enter the correct password!');\n          return console.warn('Please enter the correct password!');\n        }\n        if (inputMd5 !== password) {\n          alert(`Password error: ${input} not the correct password!`);\n          return console.warn(`Password error: ${input} not the correct password!`);\n        }\n        // cache decryption statistics\n        window.localStorage?.setItem(\n          `fixit-decryptor/#${location.pathname}`,\n          JSON.stringify({\n            expiration: Math.ceil(Date.now() / 1000) + _decryptor.options.duration,\n            md5: inputMd5,\n            sha256: inputSha256.slice(saltLen)\n          })\n        );\n        _decryptContent($content.getAttribute('data-content').replace(inputSha256.slice(saltLen), ''));\n      }\n    });\n\n    this.$el.querySelector('.fixit-encryptor-btn')?.addEventListener('click', function (e) {\n      e.preventDefault();\n      this.classList.add('d-none')\n      _decryptor.$el.querySelector('#fixit-decryptor-input').classList.remove('d-none');\n      document.querySelector('#content').innerHTML = '';\n      document.querySelector('#content').insertAdjacentElement(\n        'afterbegin',\n        _decryptor.$el\n      );\n      window.localStorage?.removeItem(`fixit-decryptor/#${location.pathname}`);\n      // reset hook\n      for (const event of _decryptor.resetEventSet) {\n        event();\n      }\n    });\n  };\n\n  /**\n   * initialize fixit-encryptor shortcodes\n   */\n  _proto.initShortcodes = () =\u003e {\n    // TODO TODO shortcode decrypted event\n    // this.addEventListener('decrypted', this.options?.decrypted);\n    const _decryptor = this;\n    const $shortcodes = document.querySelectorAll('fixit-encryptor:not(.decrypted)');\n\n    $shortcodes.forEach($shortcode =\u003e {\n      $shortcode.querySelector('.fixit-decryptor-input')?.addEventListener('keydown', function (e) {\n        if (e.key === 'Enter') {\n          e.preventDefault();\n          const $decryptor = this.parentElement.parentElement;\n          const $content = $decryptor.nextElementSibling;\n          const password = $content.getAttribute('data-password');\n          const input = this.value.trim();\n          const saltLen = input.length % 2 ? input.length : input.length + 1;\n          const inputMd5 = CryptoJS.MD5(input).toString();\n          const inputSha256 = CryptoJS.SHA256(input).toString();\n  \n          this.value = '';\n          this.blur();\n          if (!input) {\n            alert('Please enter the correct password!');\n            return console.warn('Please enter the correct password!');\n          }\n          if (inputMd5 !== password) {\n            alert(`Password error: ${input} not the correct password!`);\n            return console.warn(`Password error: ${input} not the correct password!`);\n          }\n          try {\n            const base64EncodeContent = $content.getAttribute('data-content').replace(inputSha256.slice(saltLen), '');\n            $decryptor.querySelector('.fixit-decryptor-input').classList.add('d-none');\n            $content.insertAdjacentHTML(\n              'afterbegin',\n              CryptoJS.enc.Base64.parse(base64EncodeContent).toString(CryptoJS.enc.Utf8)\n            );\n            $decryptor.parentElement.classList.add('decrypted');\n          } catch (err) {\n            return console.error(err);\n          }\n          // TODO shortcode decrypted hook\n          // for (const event of _decryptor.decryptedEventSet) {\n          //   event();\n          // }\n        }\n      });\n    });\n  };\n\n  /**\n   * validate the cached decryption statistics in localStorage\n   * @returns {FixItDecryptor}\n   */\n  _proto.validateCache = () =\u003e {\n    const $content = document.querySelector('#content');\n    const password = $content.getAttribute('data-password');\n    const cachedStat = JSON.parse(window.localStorage?.getItem(`fixit-decryptor/#${location.pathname}`));\n\n    if (!cachedStat) {\n      this.$el.querySelector('.fixit-decryptor-loading').classList.add('d-none');\n      this.$el.querySelector('#fixit-decryptor-input').classList.remove('d-none');\n      return this;\n    }\n    if (cachedStat?.md5 !== password || Number(cachedStat?.expiration) \u003c Math.ceil(Date.now() / 1000)) {\n      this.$el.querySelector('.fixit-decryptor-loading').classList.add('d-none');\n      this.$el.querySelector('#fixit-decryptor-input').classList.remove('d-none');\n      window.localStorage?.removeItem(`fixit-decryptor/#${location.pathname}`);\n      console.warn('The password has expired, please re-enter!');\n      return this;\n    }\n    _decryptContent($content.getAttribute('data-content').replace(cachedStat.sha256, ''));\n    return this;\n  };\n\n  /**\n   * add event listener for FixIt Decryptor\n   * @param {String} event event name\n   * @param {Function} listener event handler\n   * @returns {FixItDecryptor}\n   */\n  _proto.addEventListener = (event, listener) =\u003e {\n    if (typeof listener !== 'function') {\n      return this;\n    }\n    switch (event) {\n      case 'decrypted':\n        this.decryptedEventSet.add(listener);\n        break;\n      case 'reset':\n        this.resetEventSet.add(listener);\n        break;\n      default:\n        console.warn(`Event ${event} not found in FixIt Decryptor!`);\n        break;\n    }\n    return this;\n  };\n\n  /**\n   * remove event listener for FixIt Decryptor\n   * @param {String} event event name\n   * @param {Function} listener event handler\n   * @returns {FixItDecryptor}\n   */\n  _proto.removeEventListener = (event, listener) =\u003e {\n    if (typeof listener !== 'function') {\n      return this;\n    }\n    switch (event) {\n      case 'decrypted':\n        this.decryptedEventSet.delete(listener);\n        break;\n      case 'reset':\n        this.resetEventSet.delete(listener);\n        break;\n      default:\n        console.warn(`Event ${event} not found in FixIt Decryptor!`);\n        break;\n    }\n    return this;\n  };\n};\n"],"mappings":"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","names":[]}